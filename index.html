<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DietBuddy | V1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        select, button {
            padding: 8px;
            width: 200px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            background-color: #45a049;
        }
        #results {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            display: none;
        }
    </style>
</head>
<body>
    <h1>DietBuddy | V1</h1>
    <form id="recommendationForm">
        <div class="form-group">
            <label for="day_part">Day Part:</label>
            <select id="day_part" required>
                <option value="">Select Day Part</option>
                <option value="Breakfast">Breakfast</option>
                <option value="Lunch">Lunch</option>
                <option value="Dinner">Dinner</option>
            </select>
        </div>

        <div class="form-group">
            <label for="diet_type">Diet Type:</label>
            <select id="diet_type">
                <option value="">Select Diet Type</option>
                <option value="Low Carb">Low Carb</option>
                <option value="Anti - Inflammatory Diet">Anti - Inflammatory Diet</option>
                <option value="Intermittent Fasting">Intermittent Fasting</option>
                <option value="Gluten Free">Gluten Free</option>
                <option value="Soft diet (Veg) - AGB">Soft diet (Veg) - AGB</option>
                <option value="Full liquid diet- AGB">Full liquid diet- AGB</option>
                <option value="Soft diet (Non-veg) - AGB">Soft diet (Non-veg) - AGB</option>
                <option value="Vegan">Vegan</option>
                <option value="Liquid Diet- AGB">Liquid Diet- AGB</option>
                <option value="Clear liquids- AGB">Clear liquids- AGB</option>
                <option value="Detox Diet">Detox Diet</option>
            </select>
        </div>

        <div class="form-group">
            <label for="region">Region:</label>
            <select id="region">
                <option value="">Select Region</option>
                <option value="East Indian">East Indian</option>
                <option value="West Indian">West Indian</option>
                <option value="North Indian">North Indian</option>
                <option value="South Indian">South Indian</option>
            </select>
        </div>

        <div class="form-group">
            <label for="diabetic_status">Diabetic Status:</label>
            <select id="diabetic_status">
                <option value="">Select Diabetic Status</option>
                <option value="Non Diabetic">Non Diabetic</option>
                <option value="Non- Diabetic">Non- Diabetic</option>
            </select>
        </div>

        <div class="form-group">
            <label for="is_non_veg">Food Preference:</label>
            <select id="is_non_veg" required>
                <option value="false">Vegetarian</option>
                <option value="true">Non-Vegetarian</option>
            </select>
        </div>

        <button type="submit">Get Recommendations</button>
    </form>

    <div id="results">
        <h2>Recommended Food Items:</h2>
        <p>For: <span id="meal-time"></span></p>
        <ul id="recommendations"></ul>
        <button id="submitFeedback" style="display: none;">Submit Feedback</button>
    </div>

    <script>
        document.getElementById('recommendationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const dayPart = document.getElementById('day_part').value;
            const dietType = document.getElementById('diet_type').value;
            const region = document.getElementById('region').value;
            const isNonVeg = document.getElementById('is_non_veg').value;

            // Validation for empty day_part and region
            if (!dietType && !region) {
                alert('Please provide either Diet Type or Region');
                return;
            }

            // Validation for is_non_veg
            if (!isNonVeg) {
                alert('Please select a food preference (Vegetarian/Non-Vegetarian)');
                return;
            }

            const formData = {
                day_part: dayPart,
                diet_type: dietType,
                region: region,
                diabetic_status: document.getElementById('diabetic_status').value,
                recipe_link: "", // Empty as it's not needed in the form
                is_non_veg: isNonVeg === 'true'
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/predict', {
                //const response = await fetch('https://dietbuddy-backend.onrender.com/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    const resultsDiv = document.getElementById('results');
                    const recommendationsList = document.getElementById('recommendations');
                    const mealTime = document.getElementById('meal-time');
                    
                    recommendationsList.innerHTML = '';
                    mealTime.textContent = data.day_part;
                    
                    data.food_items.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <span style="font-weight: bold; color: #2c3e50">${item.food_name}</span>
                            <span style="color: grey"> â€¢ </span>
                            <span style="color: blue; font-style: italic">${item.quantity}</span>
                        `;
                        li.style.padding = '8px 0';
                        li.style.borderBottom = '1px solid #eee';
                        recommendationsList.appendChild(li);
                    });
                    
                    resultsDiv.style.display = 'block';
                    document.getElementById('submitFeedback').style.display = 'block';
                } else {
                    alert('Error: ' + data.detail);
                }
            } catch (error) {
                alert('Error connecting to the server: ' + error.message);
            }
        });

        document.getElementById('submitFeedback').addEventListener('click', async () => {
            const feedbackData = {
                user_preferences: formData,
                predicted_results: data.food_items.map(item => item.food_name),
                accepted_results: [], // To be filled based on user input
                non_acceptable_results: [], // To be filled based on user input
                new_food_items: [], // To be filled based on user input
                expected_results: [] // To be filled based on user input
            };

            // Collect user feedback
            const recommendationsList = document.getElementById('recommendations');
            recommendationsList.querySelectorAll('li').forEach(li => {
                const foodName = li.querySelector('.food-name').value;
                const quantity = li.querySelector('.quantity').value;
                const unit = li.querySelector('.unit').value;

                if (foodName && quantity) {
                    feedbackData.expected_results.push(`${foodName} (${quantity} ${unit})`);
                }
            });

            try {
                const response = await fetch('http://127.0.0.1:8000/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(feedbackData)
                });

                if (response.ok) {
                    alert('Feedback submitted successfully!');
                } else {
                    alert('Error submitting feedback');
                }
            } catch (error) {
                alert('Error connecting to the server: ' + error.message);
            }
        });

        function makeEditable(li) {
            const foodName = li.querySelector('.food-name');
            const quantity = li.querySelector('.quantity');
            const unit = li.querySelector('.unit');

            foodName.disabled = false;
            quantity.disabled = false;
            unit.disabled = false;
        }

        function addEditButton(li) {
            const editButton = document.createElement('button');
            editButton.textContent = 'Edit';
            editButton.addEventListener('click', () => makeEditable(li));
            li.appendChild(editButton);
        }

        function createFoodItemElement(item) {
            const li = document.createElement('li');
            li.innerHTML = `
                <input type="text" class="food-name" value="${item.food_name}" disabled maxlength="50" />
                <input type="number" class="quantity" value="${item.quantity}" disabled />
                <select class="unit" disabled>
                    <option value="grams">grams</option>
                    <option value="kgs">kgs</option>
                    <option value="units">units</option>
                </select>
            `;
            addEditButton(li);
            return li;
        }
    </script>
</body>
</html> 